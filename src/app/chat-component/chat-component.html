<div class="overflow-hidden">
  <!-- Chat button (when closed) -->
  @if (!isChatOpen) {
    <div class="chat-toggle" (click)="toggleChat()">
      @if (showHint) {
        <!-- Small greeting hint -->
        <div class="chat-hint mb-3 px-3 py-2 rounded-3">
          ðŸ‘‹ How can I help you?
        </div>
      }
      <button class="chat-btn button-mix-color text-white border-0 rounded-circle">
        ðŸ’¬
      </button>
    </div>
  }

  <!-- Chat window (when open) -->
  @if (isChatOpen) {
    <div @slideDownUp class="chat-container bg-black rounded-3">
      
      <!-- Header -->
      <div class="chat-header rounded-3">
        <span class="chat-title">Ai assistant</span>
        <button class="close-btn" (click)="toggleChat()">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <!-- Messages area -->
      <div class="response-text text-white" [class.empty]="messages.length === 0">
        @for (msg of messages; track $index) {
          <div [ngClass]="msg.sender">
            @if (isListMessage(msg.text)) {
              <!-- Show list if message contains many items -->
              <ul>
                @for (line of msg.text.split('\n'); track $index) {
                  @if ($index < 2) {
                    <!-- First lines are shown as plain text -->
                    <p>{{ line }}</p>
                  } @else {
                    <!-- Rest are clickable to search -->
                    <li (click)="searchAndGo(line)" class="search-item style-list py-2 pb-2">
                      {{ line }}
                    </li>
                  }
                }
              </ul>
            } @else {
              <!-- Normal message -->
              <p>{{ msg.text }}</p>
            }
          </div>
        }
      </div>

      <!-- Input area -->
      <div class="input-area">
        <input
          [(ngModel)]="userInput"
          class="border-0 bg-white p-2 rounded-3"
          placeholder="Write your question ..."
          (keydown.enter)="sendMessage()" 
        />
        <button
          class="text-white button-mix-color py-1 px-2"
          (click)="sendMessage()"
        >
          Send
        </button>
      </div>
    </div>
  }
</div>
