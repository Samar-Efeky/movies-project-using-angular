<header>
    <div *ngIf="mediaDetails" class="header-img w-100 rounded-3 position-relative">
        <img [appAnimateOnVisible]="'animate-zoom-in'" [src]="'https://image.tmdb.org/t/p/w1280'+mediaDetails.backdrop_path"
         class="w-100 h-100 rounded-3" alt="">
         <div class="overley position-absolute top-0
         start-0 w-100 h-100"></div>
    </div>
</header>
<section>
    <div *ngIf="mediaDetails" class="media-details position-relative overflow-hidden w-100 pt-5">
         <div  class="recommend-list p-3 position-absolute " (click)="onToggleRecommend()">
                <i class="fa-solid fa-bars fs-5"></i>
            </div>
        <div class="media-details-show px-2">
            <div class="video-show w-100 rounded-4 ">
                <ng-container *ngIf="trailerKey; else noTrailer">
                    <iframe
                        width="100%"
                        height="300"
                        [src]="trailerKey"
                        frameborder="0"
                        allow="autoplay; encrypted-media"
                        allowfullscreen>
                    </iframe>
                </ng-container>
                <ng-template #noTrailer>
                    <div class="text-center py-3">
                    <img *ngIf="mediaDetails" [src]="'https://image.tmdb.org/t/p/w500' + mediaDetails.poster_path"
                     alt="Poster" width="70%" height="300" class="rounded-4">
                    <p class="pt-2 ">Trailer is not available for this media.</p>
                    </div>
                </ng-template>
                <div class="d-flex justify-content-lg-between gap-2 flex-wrap bg-black pt-2 px-2 border-bottom border-secondary">
                    <p *ngIf="mediaDetails.release_date"><i class="fa-solid fa-clock"></i> {{mediaDetails.release_date|timeAgo}}</p>
                    <p *ngIf="mediaDetails.first_air_date"><i class="fa-solid fa-clock"></i> {{mediaDetails.first_air_date|timeAgo}}</p>
                    <p class="ps-lg-0 ps-2 "><i class="fa-solid fa-eye"></i> {{mediaDetails.vote_count}} views</p>
                    <div>
                        <button class="px-2 py-1 text-white bg-dark"><i class="fa-solid fa-thumbs-up"></i> Like</button>
                        <button class="px-2 py-1 ms-1 bg-dark text-white"><i class="fa-solid fa-thumbs-down"></i> Dislike</button>
                    </div>
                    <div>
                        <button class="px-2 py-1 text-white bg-dark"><i class="fa-solid fa-share"></i> Share</button>
                    </div>
                </div>
            </div>
            <div class="details-show mt-2">
                <div class="pt-5 pb-1 border-bottom border-secondary">
                    <h3 [appAnimateOnVisible]="'animate-slide-down'" *ngIf="mediaDetails.title">{{mediaDetails.title}}</h3>
                    <h3 [appAnimateOnVisible]="'animate-slide-down'" *ngIf="mediaDetails.name">{{mediaDetails.name}}</h3>
                </div>
                <div class="py-3 border-bottom border-secondary">
                    <p [appAnimateOnVisible]="'animate-slide-up'">
                       {{ showFullOverview ? mediaDetails.overview : (mediaDetails.overview)|seeMore:30  }}
                    </p>
                <ng-container *ngIf="showFullOverview" >
                    <h4 class="pt-3">Cast</h4>
                    <div class="d-flex gap-3 flex-wrap">
                        @for(castPerson of cast; track castPerson.id){
                            <div (click)="goToProfileDetails('person', castPerson.id)"
                             *ngIf="castPerson.profile_path"
                              class="cast-person p-2 text-center overflow-hidden">
                                <img [appAnimateOnVisible]="'animate-zoom-in'" (click)="goToProfileDetails('person', castPerson.id)"
                                 [src]="'https://image.tmdb.org/t/p/w500' +castPerson.profile_path"
                                 [alt]="castPerson.name" width="100" height="100"
                                 class="rounded-circle">
                                <p [appAnimateOnVisible]="'animate-slide-up'" class="pt-2">{{castPerson.name}}</p> 
                            </div>
                        }
                    </div>
                </ng-container>
                <ng-container *ngIf="showFullOverview">
                    <h4 class="pt-3">Crew</h4>
                    <div class="d-flex gap-3 flex-wrap">
                        @for(crewPerson of crew; track crewPerson.id){
                            <div (click)="goToProfileDetails('person', crewPerson.id)" 
                            *ngIf="crewPerson.profile_path"
                             class="crew-person p-2 text-center overflow-hidden">
                                <img [appAnimateOnVisible]="'animate-zoom-in'"
                                 (click)="goToProfileDetails('person', crewPerson.id)"
                                 [src]="'https://image.tmdb.org/t/p/w500' +crewPerson.profile_path"
                                 [alt]="crewPerson.name" width="100" height="100"
                                 class="rounded-circle">
                                <p [appAnimateOnVisible]="'animate-slide-up'" class="pt-2">{{crewPerson.name}}</p> 
                            </div>
                        }
                    </div>
                </ng-container>
                
                 <a  (click)="toggleOverview();" class="see-more-link">
                    {{ showFullOverview ? 'See less' : 'See more' }}
                </a>
                </div>
                <div  class="pt-4">
                    <h5 >Production companies</h5>
                   <div class="d-flex justify-content-center flex-wrap gap-4 pt-4 border-bottom border-secondary">
                     @for(company of mediaDetails.production_companies; track company.id){
                            @if (company.logo_path) {
                                <div class="company-container text-center overflow-hidden">
                                <div class="  rounded-3 bg-white">
                                    <img [appAnimateOnVisible]="'animate-zoom-in'"
                                    [src]="'https://image.tmdb.org/t/p/w500' + company.logo_path" 
                                    alt="{{company.name}} Logo" 
                                     class="">
                                </div>
                                <p [appAnimateOnVisible]="'animate-slide-up'" class="pt-2">{{company.name|seeMore:2}}</p>
                                </div>
                            }
                    }
                   </div>
                </div>
                <!-- reviews -->
               <div class="pt-5">
                 <div class="comments-container  rounded-3 p-xl-4 p-3 w-100 overflow-hidden">
                    <h5 [appAnimateOnVisible]="'animate-slide-down'" class="fw-bold mb-3">Comments</h5>
                    <div class="mb-3">
                        <textarea class="form-control bg-black text-white border-0" [(ngModel)]="newComment"
                         placeholder="Add a comment..." rows="3"></textarea>
                        <div class="mt-2 d-flex justify-content-start gap-2">
                            <button class="btn btn-outline-light btn-sm" (click)="cancelComment()">Cancel</button>
                            <button class="button-mix-color text-white" [disabled]="!newComment.trim()" (click)="postComment()">Post Comment</button>
                        </div>
                    </div>
                   @for(review of reviewsList; track review.id){
                        <div *ngIf="review.author_details.avatar_path"  class="bg-black mb-3 rounded-3 p-3">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <img [appAnimateOnVisible]="'animate-zoom-in'"
                                     [src]="'https://image.tmdb.org/t/p/w500'+ review.author_details.avatar_path"
                                    class="rounded-circle me-2" width="50" height="50" alt="avatar" />
                                    <span class="fw-semibold text-white ps-2">
                                        &#64;{{review.author_details.username}}</span>
                                    <span class="date-content ps-3">{{review.created_at|timeAgo}}</span>
                                </div>
                                <div class="pt-1">
                                    <button class=" px-2 py-1 bg-primary">Reply</button>
                                </div>
                            </div>
                            <div class="text-light small my-2">
                                {{ isFullShown(review.id) ? review.content : (review.content | seeMore:35) }}
                                <a *ngIf="isLongComment(review.content)" 
                                    (click)="toggleComment(review.id)" class="see-more-link">
                                    {{ isFullShown(review.id) ? 'See less' : 'See more' }}
                                </a>
                            </div>
                        </div>
                    }
                </div>
               </div><!-- review -->
            </div>
        </div>
        <div [ngStyle]="{ 'right': MoveRight? '0%' :'-100%'}" class="recommendations mt-md-0 mt-5 rounded-3 p-3 ">
            @for(recommendation of mediaRecommendations; track recommendation.id){
                <div class="w-100 d-flex  p-2 mb-2 bg-black rounded-3 overflow-hidden">
                    <img [appAnimateOnVisible]="'animate-zoom-in'"
                     (click)="[goToMediaDetails(type,recommendation.id), onToggleRecommend()]"
                      [src]="'https://image.tmdb.org/t/p/w500'+ recommendation.poster_path" height="100"
                     class=" rounded-3" alt="">
                    <div class="ps-2">
                        <p *ngIf="recommendation.title" [appAnimateOnVisible]="'animate-slide-down'"
                         (click)="[goToMediaDetails(type,recommendation.id), onToggleRecommend()]"
                          class=" media-title">
                            {{recommendation.title|seeMore:4}}
                        </p>
                        <p *ngIf="recommendation.name" [appAnimateOnVisible]="'animate-slide-down'"
                         (click)="[goToMediaDetails(type,recommendation.id), onToggleRecommend()]"
                         class=" media-title">
                            {{recommendation.name|seeMore:4}}
                        </p>
                        <span *ngIf="recommendation.release_date">
                            <i class="fa-solid fa-clock"></i> {{recommendation.release_date|timeAgo}}
                        </span>
                        <span *ngIf="recommendation.first_air_date">
                            <i class="fa-solid fa-clock"></i> {{recommendation.first_air_date|timeAgo}}
                        </span><br>
                        <span><i class="fa-solid fa-eye"></i> {{recommendation.vote_count}} views</span>
                    </div> 
                </div>
            }
        </div>
    </div>
</section>
